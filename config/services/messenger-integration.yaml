services:

    App\MessengerIntegration\Serializer\IntegrationSerializer:
        arguments:
            $bodySerializer: '@App\MessengerIntegration\Serializer\Body\BodySerializerInterface'
            $messengerStampsSerializer: '@App\MessengerIntegration\Serializer\MessengerStamps\MessengerStampsSerializerInterface'
            $integrationStampsSerializer: '@App\MessengerIntegration\Serializer\IntegrationStamps\IntegrationStampsSerializerInterface'
            $logger: '@monolog.logger.integration'
            $integrationMessageAttributeStorage: '@App\MessengerIntegration\Message\IntegrationMessageAttributeStorage'

    App\MessengerIntegration\Serializer\Body\BodySerializerInterface:
        alias: App\MessengerIntegration\Serializer\Body\JsonMessageBodySerializer

    App\MessengerIntegration\Serializer\Body\JsonMessageBodySerializer:


    App\MessengerIntegration\Serializer\IntegrationStamps\IntegrationStampsSerializerInterface:
        alias: App\MessengerIntegration\Serializer\IntegrationStamps\IntegrationStampsSerializer

    App\MessengerIntegration\Serializer\IntegrationStamps\IntegrationStampsSerializer:

    App\MessengerIntegration\Serializer\MessengerStamps\MessengerStampsSerializerInterface:
        alias: App\MessengerIntegration\Serializer\MessengerStamps\MessengerStampsSerializer

    App\MessengerIntegration\Serializer\MessengerStamps\MessengerStampsSerializer:
        arguments:
            $symfonySerializer: '@serializer'

    # TODO - do we need this?
    App\MessengerIntegration\Inbox\InputInboxService:
        arguments:
            $logger: '@monolog.logger.application'
            $integrationSerializer: '@App\MessengerIntegration\Serializer\IntegrationSerializer'
            $messageBus: '@application_bus'

    # Message magic
    App\MessengerIntegration\Message\IntegrationMessageAttributeStorage:
        tags:
            - { name: 'messenger.integration.storage' }

    # Middleware
    App\MessengerIntegration\Middleware\InboxRouterMiddleware:
        arguments:
            $logger: '@monolog.logger.integration'
            $inboxTransport: '@messenger.transport.inbox_transport'

    App\MessengerIntegration\Middleware\OutboxRouterMiddleware:
        arguments:
            $logger: '@monolog.logger.integration'
            $outboxTransport: '@messenger.transport.outbox_transport'

    App\MessengerIntegration\Middleware\OutgoingHttpRouterMiddleware:
        arguments:
            $logger: '@monolog.logger.integration'
            $httpTransport: '@messenger.transport.http_publisher_transport'

    App\MessengerIntegration\Middleware\OutgoingKafkaRouterMiddleware:
        arguments:
            $logger: '@monolog.logger.integration'
            $kafkaTransport: '@messenger.transport.kafka_publisher_transport'

    # Transport factories
    App\MessengerIntegration\Transport\Http\IntegrationHttpTransportSenderFactory:
        arguments:
            $integrationMessageAttributeStorage: '@App\MessengerIntegration\Message\IntegrationMessageAttributeStorage'
            $serializer: '@App\MessengerIntegration\Serializer\IntegrationSerializer'
            $logger: '@monolog.logger.application'
            $externalSystemEndpointsPrefixMap: # TODO - do it better
                'some_system': 'http://somesystem.local'
                'some_other': 'http://someother.local'

        tags:
            - { name: 'messenger.transport_factory' }

    App\MessengerIntegration\Transport\Kafka\IntegrationKafkaSenderTransportFactory:
        tags:
            - { name: 'messenger.transport_factory' }
